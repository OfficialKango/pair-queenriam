<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malvin PAIR CODE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    /* Full-screen background and centered content */
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-image: url("https://i.ibb.co/bM6pw4vf/malvin-xd.jpg");
      background-repeat: no-repeat;
      background-position: center;
      background-size: cover;
      font-family: Arial, sans-serif;
      overflow: hidden; /* Prevent scrolling */
    }

    /* Overlay for the blur effect */
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(6px);
      background: rgba(0, 0, 0, 0.5);
    }

    /* Main container for the form */
    .container {
      position: relative;
      z-index: 2; /* To be above the overlay */
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 90%;
      max-width: 400px;
      padding: 2rem;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 1.5rem;
      text-align: center;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: #fff;
    }

    h2 { font-size: 1.6rem; margin-bottom: 0.4rem; }
    h4 { font-weight: 400; font-size: 0.95rem; margin-bottom: 1rem; color: #ddd; }

    /* Input group */
    .input-container {
      display: flex;
      gap: 0.5rem;
      border-radius: 1rem;
      background: linear-gradient(45deg, #c5c5c5 0%, #ffffff 100%);
      padding: 0.3rem;
      max-width: 300px;
      width: 100%;
    }

    .input-container input {
      flex: 1;
      padding: 0.9rem;
      font-size: 1rem;
      border: none;
      border-radius: 0.8rem 0 0 0.8rem;
      background: #e8e8e8;
      color: #000;
      transition: all 0.2s ease-in-out;
    }
    
    .input-container input:focus {
      outline: none;
      border-left: 2px solid #ff9d9d;
    }

    .input-container button {
      padding: 0.9rem 1.2rem;
      background: linear-gradient(135deg, #8a2be2 0%, #800080 100%);
      border: none;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border-radius: 0 1rem 1rem 0;
      transition: all 0.3s ease;
    }

    .input-container button:hover {
      background: linear-gradient(135deg, #A8E4A0 0%, #32CD32 100%);
      color: red;
    }

    /* Status and Result messages */
    .status-text, #pairResult { margin-top: 1rem; font-weight: bold; color: yellow; }
    .status-text.error { color: red; }
    .status-text.success { color: #32CD32; }

    /* Glowing Text */
    .glowing-text {
      margin-top: 2rem;
      font-size: 1rem;
      font-weight: bold;
      color: white;
      text-shadow: 
        0 0 5px #f0f, 
        0 0 10px #f0f, 
        0 0 20px #0ff;
      animation: glowPulse 3s infinite;
    }

    .copy-code {
      cursor: pointer; 
      background: rgba(255, 255, 255, 0.15);
      padding: 0.8rem; 
      border-radius: 0.5rem;
      color: yellow; 
      margin-top: 1rem; 
      transition: 0.2s;
      word-break: break-all;
    }

    .copy-code:hover { 
      background: rgba(255, 255, 255, 0.4); 
      color: #000; 
    }

    /* Spinner */
    .spinner {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid #fff;
      border-top: 3px solid #00eaff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes glowPulse { 0% { text-shadow: 0 0 5px #f0f; } 50% { text-shadow: 0 0 15px #0ff; } 100% { text-shadow: 0 0 5px #f0f; } }

    /* Responsive design for smaller screens */
    @media (max-width: 480px) {
      .input-container {
        flex-direction: column;
      }
      .input-container input {
        border-radius: 0.8rem;
      }
      .input-container button {
        padding: 1rem;
        border-radius: 0.8rem;
      }
      .container { padding: 1.2rem; }
    }
    
    /* Music icon */
    .music-icon {
      position: fixed;
      bottom: 20px;
      right: 20px;
      color: #fff;
      font-size: 1.8rem;
      z-index: 3;
      cursor: pointer;
      animation: pulse 2s infinite;
      text-shadow: 0 0 10px #00c6ff, 0 0 20px #00c6ff;
    }

    @keyframes pulse { 0%,100%{transform:scale(1);opacity:0.8;} 50%{transform:scale(1.2);opacity:1;} }

    /* Pop-up message styling */
    #popup-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px 30px;
      border-radius: 10px;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      font-weight: bold;
    }

  </style>
</head>
<body>

<audio id="background-music" loop>
  <source src="https://files.catbox.moe/tvw1kz.mp3" type="audio/mpeg" />
</audio>
<div class="music-icon" id="music-toggle" title="Toggle Music">
  <i class="fas fa-music"></i>
</div>

<div id="popup-message"></div>

<div class="overlay"></div>

<div class="container">
  <h2><i class="fa-solid fa-user-gear"></i> Malvin PAIR</h2>
  <h4>‚öô Enter your WhatsApp number with country code ‚öô</h4>

  <div class="input-container">
    <input type="number" id="number" placeholder="e.g., 233509977xxx" autocomplete="off" />
    <button id="submit">Pair</button>
  </div>

  <div id="status" class="status-text"></div>
  <div id="pairResult"></div>

  <div class="glowing-text">‚ö° Powered by Malvin King ‚ö°</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.0.0-alpha.1/axios.min.js"></script>
<script>
  // üìã Copy to clipboard (with fallback)
  async function copyToClipboard(text) {
    try {
      await navigator.clipboard.writeText(text);
      document.getElementById("status").innerHTML = '<span class="success">‚úÖ Copied to clipboard!</span>';
    } catch {
      const temp = document.createElement("textarea");
      temp.value = text;
      document.body.appendChild(temp);
      temp.select();
      document.execCommand("copy");
      document.body.removeChild(temp);
      document.getElementById("status").innerHTML = '<span class="success">‚úÖ Copied to clipboard!</span>';
    }
  }

  // üéµ Music toggle logic
  const musicToggle = document.getElementById("music-toggle");
  const music = document.getElementById("background-music");
  const popup = document.getElementById("popup-message");

  function showPopup(message) {
    popup.innerText = message;
    popup.style.opacity = '1';
    setTimeout(() => {
      popup.style.opacity = '0';
    }, 1500);
  }

  musicToggle.addEventListener("click", () => {
    if (music.paused) {
      music.play().then(() => {
        musicToggle.innerHTML = '<i class="fas fa-music"></i>';
        showPopup("üé∂ Music On");
      }).catch(error => {
        showPopup("üö´ Play failed. Browser blocked autoplay.");
        console.error("Autoplay was prevented:", error);
      });
    } else {
      music.pause();
      musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
      showPopup("üîá Music Off");
    }
  });

  // üîë Pair button logic
  const submitBtn = document.getElementById("submit");
  const numberInput = document.getElementById("number");
  const statusText = document.getElementById("status");
  const resultDiv = document.getElementById("pairResult");

  submitBtn.addEventListener("click", async () => {
    const rawNumber = numberInput.value.trim();
    if (!rawNumber) {
      statusText.innerHTML = '<span class="error">‚ùó Please enter a valid number.</span>';
      resultDiv.innerHTML = '';
      return;
    }
    
    // Clean the number from any non-digit characters
    const cleanNumber = rawNumber.replace(/[^0-9]/g, "");

    // Simple validation for number length
    if (cleanNumber.length < 10) {
      statusText.innerHTML = '<span class="error">‚ùå Invalid number format.</span>';
      resultDiv.innerHTML = '';
      return;
    }

    statusText.innerHTML = '<div class="spinner"></div><br><span class="status-text">Please wait...</span>';
    resultDiv.innerHTML = '';

    try {
      const res = await axios.get(`/code?number=${cleanNumber}`, { timeout: 15000 });
      const code = res.data.code || "Service Unavailable";
      resultDiv.innerHTML = `<div class="copy-code" onclick="copyToClipboard('${code}')">CODE: ${code}</div>`;
      statusText.innerHTML = '<span class="success">‚úÖ Code fetched successfully! Click to copy.</span>';
    } catch (err) {
      statusText.innerHTML = '<span class="error">‚ùå Failed to fetch code. Please try again.</span>';
      resultDiv.innerHTML = "";
    }
  });
</script>
</body>
</html>
